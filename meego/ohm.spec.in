Summary: Open Hardware Manager
Name: ohm
Version: ##__VERSION__##
Release: 1
License: LGPLv2.1
Group: System/Daemons
URL: http://meego.gitorious.org/maemo-multimedia/ohm
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
Requires: pl >= 5.6.32
Requires: ohm-plugin-core
BuildRequires: pkgconfig(glib-2.0)
BuildRequires: pkgconfig(dbus-1)
BuildRequires: pkgconfig(dbus-glib-1)
BuildRequires: pkgconfig(check)
BuildRequires: pkgconfig(libsimple-trace)

%package config
Summary: Common configuration files for OHM
Group: System Environment/Daemons

%package plugin-core
Summary: Common OHM libraries
Group: System/Daemons

%package devel
Summary: Files necessary for OHM plugin development
Group: Development/Libraries
Requires: %{name} = %{version}
Requires: ohm-plugin-core
Requires: libtrace-devel

#%package plugins-legacy
#Summary: Legacy plugins for the Open Hardware Manager.
#Group: System Environment/Daemons

%package utils
Summary: Miscallaneous OHM utilities
Group: System Environment/Daemons

%description
Open Hardware Manager

%description config
This package contains common OHM configuration files.

%description plugin-core
This package contains libraries needed by both for running OHM and
developing OHM plugins.

%description devel
This package contains header files, libraries, pkg-config files, etc.
necessary for developing OHM plugins.

#%description plugins-legacy
#Lagacy plugins for OHM.

%description utils
This package contains miscallaneous OHM utilities that are either not
very useful or not necessary for everyday OHM usage.

%prep
%setup -q -n ##__TARDIR__##

%build
%configure --disable-static --without-xauth --disable-dpms --disable-legacy --with-distro=redhat
make

%install
rm -rf $RPM_BUILD_ROOT
%make_install
# make sure we get a plugin config dir even with legacy plugins disabled
mkdir -p $RPM_BUILD_ROOT/%{_sysconfdir}/ohm/plugins.d


%clean
rm -rf $RPM_BUILD_ROOT

%post plugin-core
/sbin/ldconfig

%postun plugin-core
/sbin/ldconfig


%files
%defattr(-,root,root,-)
%{_initrddir}/ohmd
%{_sbindir}/*ohm*
%{_sysconfdir}/event.d/ohmd
#%{_datadir}/locale
%doc README COPYING INSTALL AUTHORS NEWS ChangeLog

%files config
%defattr(-,root,root,-)
%dir %{_sysconfdir}/ohm
%dir %{_sysconfdir}/ohm/plugins.d
%config %{_sysconfdir}/ohm/modules.ini
%config %{_sysconfdir}/dbus-1/system.d/ohm.conf

%files plugin-core
%defattr(-,root,root,-)
%{_libdir}/libohm*.so.*

%files devel
%defattr(-,root,root,-)
%{_includedir}/ohm
%{_libdir}/libohm*.so
%{_libdir}/pkgconfig/*

#%files plugins-legacy
#%defattr(-,root,root,-)
#%config %{_sysconfdir}/ohm/plugins.d/*
#%{_libdir}/ohm

%files utils
%defattr(-,root,root,-)
#%{_bindir}/*ohm*
